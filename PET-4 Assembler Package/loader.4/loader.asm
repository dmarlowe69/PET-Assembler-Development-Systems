;********************************;.PAGE 'LOADER4';.OPT LIST;*********************************=$0400;********************************; EXTERNAL ADDRESS EQUATES;********************************CHKIN=$FFC6CLRCHN=$FFCCCHRIN=$FFCF;********************************;;********************************HH0400 .BYTE $00HH0401 .WORD BASIC       .BYTE $0A,$00       .BYTE $9E       .TEXT '(1039)'       .BYTE $00BASIC  .BYTE $00,$00;********************************XX040F LDA #$00       STA $0283       STA $0294       STA $027F       STA $0280       STA $027C       STA $027D;********************************; PRINT TITLE BANNER; AND PROMPT FOR LOAD ADDRESS OFFSET;********************************       LDX #AA05DF-XX059F ;#$40      ;'@'       JSR XX0589XX0428 JSR CHRIN       CMP #$20      ;' '       BEQ XX0428       CMP #$0D       BEQ XX0443       JSR $D76B       BCC XX040F       STA $027D       JSR $D763       BCC XX040F       STA $027C;********************************; PRINT REQUEST FOR OBJECT FILE NAME;********************************XX0443 LDX #AA062D-XX059F ;#$8E       JSR XX0589       LDX #$28      ;'('       STX $0281XX044D DEC $0281       BEQ XX040F       JSR CHRIN       CMP #$20      ;' '       BEQ XX044D       CMP #$0D       BNE XX0460       JMP XX0579;********************************XX0460 LDX #$00       STX $0294       BEQ XX046EXX0467 JSR CHRIN       CMP #$20      ;' '       BEQ XX0483XX046E CMP #$0D       BEQ XX0483       LDX $0294       CPX #$0E       BEQ XX040F       STA $0284,X       INX        STX $0294       JMP XX0467;********************************XX0483 LDA #$2C      ;','       STA $0284,X       INX        LDA #$53      ;'S'       STA $0284,X       INX        STX $0294       LDA #$0D       JSR $E202       LDA #$07       STA $D2       LDA #$02       STA $D1       LDA #$08       STA $D4       LDA #$0F       STA $D3       LDA #$49      ;'I'       STA $027A       LDA #$30      ;'0'       STA $027B       LDA #$02       STA $DB       LDA #$7A       STA $DA       JSR $F563       LDA #$07       JSR $F2E2       LDA #$31      ;'1'       STA $027B       JSR $F563       LDA #$07       JSR $F2E2       LDA #$07       STA $D3       LDA #$02       STA $DB       LDA #$84       STA $DA       LDA $0294       STA $D1       JSR $F563XX04E2 JSR $F335       BNE XX04EA       JMP XX0571;********************************XX04EA JSR XX0662       CMP #$3B      ;';'       BNE XX04E2       LDA #$00       STA $027A       STA $027B       STA $0281       JSR XX0640       BNE XX0513       JSR XX0640       CMP $0280       BNE XX0574       JSR XX0640       CMP $027F       BNE XX0574       BEQ XX0579XX0513 STA $027E       INC $027F       BNE XX051E       INC $0280XX051E JSR XX067D       JSR XX0640       PHA        CLC        ADC $027D       STA $43       PLA        JSR XX067D       JSR XX0640       PHA        CLC        ADC $027C       STA $42       BCC XX053D       INC $43XX053D PLA        JSR XX067DXX0541 JSR XX0640       LDY $0281       INC $0281       STA ($42),Y       CMP ($42),Y       BNE XX056B       JSR XX067D       DEC $027E       BNE XX0541       JSR XX0640       CMP $027B       BNE XX056E       JSR XX0640       CMP $027A       BNE XX056E       JMP XX04E2;********************************; PRINT NON-RAM LOAD;********************************XX056B LDX #AA05C3-XX059F ;#$24      ;'$';********************************       .BYTE $2C ;BIT ZP SKIP;********************************; PRINT CHECKSUM ERROR;********************************XX056E LDX #AA05D0-XX059F ;#$31      ;'1';********************************       .BYTE $2C ;BIT ZP SKIP;********************************; PRINT BREAK;********************************XX0571 LDX #AA05B0-XX059F ;#$11;********************************       .BYTE $2C ;BIT ZP SKIP;********************************; PRINT BAD RECORD COUNT;********************************XX0574 LDX #$00       JSR XX0589XX0579 LDA #$07       JSR $F2E2       JSR CLRCHN;********************************; PRINT END OF LOAD;********************************       LDX #AA05B7-XX059F ;#$18       JSR XX0589       JMP $B3FF;********************************XX0589 STX $0281XX058C LDX $0281       LDA XX059F,X       PHP        AND #$7F       JSR $E202       INC $0281       PLP        BPL XX058C       RTS ;********************************;********************************XX059F .BYTE $0D       .TEXT 'BAD RECORD COUN'       .BYTE $D4;AA05B0 .BYTE $0D       .TEXT 'BREAK'       .BYTE $8D;AA05B7 .BYTE $0D       .TEXT 'END OF LOA'       .BYTE $C4;AA05C3 .BYTE $0D       .TEXT 'NON-RAM LOA'       .BYTE $C4;AA05D0 .BYTE $0D       .TEXT 'CHECKSUM ERRO'       .BYTE $D2;AA05DF .BYTE $0D       .BYTE $0D       .BYTE $0D       .TEXT 'LOW LOADER V121379'       .BYTE $0D       .TEXT '(C) 1979 BY COMMODORE BUSINESS MACHINES'       .BYTE $0D       .BYTE $0D       .BYTE $0D       .TEXT 'INPUT OFFSET?'       .BYTE $A0;AA062D .BYTE $0D       .TEXT 'OBJECT FILE NAME?'       .BYTE $A0;********************************XX0640 JSR XX0662       JSR XX0657       ASL A       ASL A       ASL A       ASL A       STA $0282       JSR XX0662       JSR XX0657       ORA $0282       RTS ;********************************XX0657 CMP #$3A      ;':'       PHP        AND #$0F       PLP        BCC XX0661       ADC #$08XX0661 RTS ;********************************XX0662 LDA $0283       CMP #$07       BEQ XX0674       JSR CLRCHN       LDX #$07       STX $0283       JSR CHKINXX0674 JSR CHRIN       PHA        JSR $E202       PLA        RTS ;********************************XX067D CLC        ADC $027A       STA $027A       BCC XX0689       INC $027BXX0689 RTS ;********************************       TAX        TAX        TAX        TAX        TAX        TAX ;********************************.END