;********************************;.PAGE 'HILOADER32';.OPT LIST;*********************************=$7000;********************************; EXTERNAL ADDRESS EQUATES;********************************CLRCHN=$FFCC;********************************       JMP XX701E;********************************;;********************************XX7003 .BYTE $AAXX7004 .BYTE $AAXX7005 .BYTE $AAXX7006 .BYTE $AAXX7007 .BYTE $AAXX7008 .BYTE $AAXX7009 .BYTE $AAXX700A .BYTE $AAXX700B .BYTE $AAXX700C .BYTE $AAXX700D .BYTE $AA       .BYTE $AA       .BYTE $AA       .BYTE $AA       .BYTE $AA       .BYTE $AA       .BYTE $AA       .BYTE $AA       .BYTE $AA       .BYTE $AA       .BYTE $AA       .BYTE $AA       .BYTE $AA       .BYTE $AA       .BYTE $AA       .BYTE $AAXX701D .BYTE $AA;********************************;;********************************XX701E LDA #$00       STA XX700C       STA XX701D       STA XX7008       STA XX7009       STA XX7005       STA XX7006;********************************; PRINT STARTUP BANNER;********************************       LDX #AA71EE-XX71AE ;#$40      ;'@'       JSR XX7198XX7037 JSR $F1E1       CMP #$20      ;' '       BEQ XX7037       CMP #$0D       BEQ XX7052       JSR $E7BE       BCC XX701E       STA XX7006       JSR $E7B6       BCC XX701E       STA XX7005;********************************; OBJECT FILE NAME?;********************************XX7052 LDX #AA723C-XX71AE ;#$8E       JSR XX7198       LDX #$28      ;'('       STX XX700AXX705C DEC XX700A       BEQ XX701E       JSR $F1E1       CMP #$20      ;' '       BEQ XX705C       CMP #$0D       BNE XX706F       JMP XX7188;********************************;;********************************XX706F LDX #$00       STX XX701D       BEQ XX707DXX7076 JSR $F1E1       CMP #$20      ;' '       BEQ XX7092XX707D CMP #$0D       BEQ XX7092       LDX XX701D       CPX #$0E       BEQ XX701E       STA XX700D,X       INX        STX XX701D       JMP XX7076;********************************;;********************************XX7092 LDA #$2C      ;','       STA XX700D,X       INX        LDA #$53      ;'S'       STA XX700D,X       INX        STX XX701D       LDA #$0D       JSR $E3D8       LDA #$07       STA $D2       LDA #$02       STA $D1       LDA #$08       STA $D4       LDA #$0F       STA $D3       LDA #$49      ;'I'       STA XX7003       LDA #$30      ;'0'       STA XX7004       LDA #$70       STA $DB       LDA #$03       STA $DA       JSR $F524       LDA #$07       JSR $F2AE       LDA #$31      ;'1'       STA XX7004       JSR $F524       LDA #$07       JSR $F2AE       LDA #$07       STA $D3       LDA #$70       STA $DB       LDA #$0D       STA $DA       LDA XX701D       STA $D1       JSR $F524XX70F1 JSR $F301       BNE XX70F9       JMP XX7180;********************************;;********************************XX70F9 JSR XX7271       CMP #$3B      ;';'       BNE XX70F1       LDA #$00       STA XX7003       STA XX7004       STA XX700A       JSR XX724F       BNE XX7122       JSR XX724F       CMP XX7009       BNE XX7183       JSR XX724F       CMP XX7008       BNE XX7183       BEQ XX7188XX7122 STA XX7007       INC XX7008       BNE XX712D       INC XX7009XX712D JSR XX728C       JSR XX724F       PHA        CLC        ADC XX7006       STA $43       PLA        JSR XX728C       JSR XX724F       PHA        CLC        ADC XX7005       STA $42       BCC XX714C       INC $43XX714C PLA        JSR XX728CXX7150 JSR XX724F       LDY XX700A       INC XX700A       STA ($42),Y       CMP ($42),Y       BNE XX717A       JSR XX728C       DEC XX7007       BNE XX7150       JSR XX724F       CMP XX7004       BNE XX717D       JSR XX724F       CMP XX7003       BNE XX717D       JMP XX70F1;********************************; NON-RAM LOAD;********************************XX717A LDX #AA71D2-XX71AE ;#$24      ;'$';********************************;;********************************       .BYTE $2C ;BIT ZP SKIP;********************************; CHECKSUM ERROR;********************************XX717D LDX #AA71DF-XX71AE ;#$31      ;'1';********************************;;********************************       .BYTE $2C ;BIT ZP SKIP;********************************; BREAK;********************************XX7180 LDX #AA71BF-XX71AE ;#$11;********************************       .BYTE $2C ;BIT ZP SKIP;********************************; BAD RECORD COUNT;********************************XX7183 LDX #$00       JSR XX7198XX7188 LDA #$07       JSR $F2AE       JSR CLRCHN;********************************; END OF LOAD;********************************       LDX #AA71C6-XX71AE ;#$18       JSR XX7198       JMP $C389;********************************;;********************************XX7198 STX XX700AXX719B LDX XX700A       LDA XX71AE,X       PHP        AND #$7F       JSR $E3D8       INC XX700A       PLP        BPL XX719B       RTS ;********************************;;********************************XX71AE .BYTE $0D       .TEXT 'BAD RECORD COUN'       .BYTE $D4;AA71BF .BYTE $0D       .TEXT 'BREAK'       .BYTE $8D;AA71C6 .BYTE $0D       .TEXT 'END OF LOA'       .BYTE $C4;AA71D2 .BYTE $0D       .TEXT 'NON-RAM LOA'       .BYTE $C4;AA71DF .BYTE $0D       .TEXT 'CHECKSUM ERRO'       .BYTE $D2;AA71EE .BYTE $0D       .BYTE $0D       .BYTE $0D       .TEXT '32K LOADER V121379'       .BYTE $0D       .TEXT '(C) 1979 BY COMMODORE BUSINESS MACHINES'       .BYTE $0D       .BYTE $0D       .BYTE $0D       .TEXT 'INPUT OFFSET?'       .BYTE $A0;AA723C .BYTE $0D       .TEXT 'OBJECT FILE NAME?'       .BYTE $A0;********************************;;********************************XX724F JSR XX7271       JSR XX7266       ASL A       ASL A       ASL A       ASL A       STA XX700B       JSR XX7271       JSR XX7266       ORA XX700B       RTS ;********************************;;********************************XX7266 CMP #$3A      ;':'       PHP        AND #$0F       PLP        BCC XX7270       ADC #$08XX7270 RTS ;********************************;;********************************XX7271 LDA XX700C       CMP #$07       BEQ XX7283       JSR CLRCHN       LDX #$07       STX XX700C       JSR $F770XX7283 JSR $F1E1       PHA        JSR $E3D8       PLA        RTS ;********************************;;********************************XX728C CLC        ADC XX7003       STA XX7003       BCC XX7298       INC XX7004XX7298 RTS ;********************************;;********************************AA7299 .BYTE $AA       .BYTE $AA       .BYTE $AA       .BYTE $AA       .BYTE $AA       .BYTE $AA       .BYTE $AA;********************************;;********************************.END