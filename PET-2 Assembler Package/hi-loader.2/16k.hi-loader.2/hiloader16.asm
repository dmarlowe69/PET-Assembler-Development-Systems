;********************************;.PAGE 'HILOADER16';.OPT LIST;*********************************=$3000;********************************; EXTERNAL ADDRESS EQUATES;********************************CLRCHN=$FFCC;********************************       JMP XX301E;********************************;;********************************XX3003 .BYTE $AAXX3004 .BYTE $AAXX3005 .BYTE $AAXX3006 .BYTE $AAXX3007 .BYTE $AAXX3008 .BYTE $AAXX3009 .BYTE $AAXX300A .BYTE $AAXX300B .BYTE $AAXX300C .BYTE $AAXX300D .BYTE $AA       .BYTE $AA       .BYTE $AA       .BYTE $AA       .BYTE $AA       .BYTE $AA       .BYTE $AA       .BYTE $AA       .BYTE $AA       .BYTE $AA       .BYTE $AA       .BYTE $AA       .BYTE $AA       .BYTE $AA       .BYTE $AA       .BYTE $AAXX301D .BYTE $AA;********************************;;********************************XX301E LDA #$00       STA XX300C       STA XX301D       STA XX3008       STA XX3009       STA XX3005       STA XX3006;********************************; PRINT STARTUP BANNER;********************************       LDX #AA71EE-XX31AE ;#$40      ;'@'       JSR XX3198XX3037 JSR $F1E1       CMP #$20      ;' '       BEQ XX3037       CMP #$0D       BEQ XX3052       JSR $E7BE       BCC XX301E       STA XX3006       JSR $E7B6       BCC XX301E       STA XX3005;********************************; OBJECT FILE NAME?;********************************XX3052 LDX #AA723C-XX31AE ;#$8E       JSR XX3198       LDX #$28      ;'('       STX XX300AXX305C DEC XX300A       BEQ XX301E       JSR $F1E1       CMP #$20      ;' '       BEQ XX305C       CMP #$0D       BNE XX306F       JMP XX3188;********************************;;********************************XX306F LDX #$00       STX XX301D       BEQ XX307DXX3076 JSR $F1E1       CMP #$20      ;' '       BEQ XX3092XX307D CMP #$0D       BEQ XX3092       LDX XX301D       CPX #$0E       BEQ XX301E       STA XX300D,X       INX        STX XX301D       JMP XX3076;********************************;;********************************XX3092 LDA #$2C      ;','       STA XX300D,X       INX        LDA #$53      ;'S'       STA XX300D,X       INX        STX XX301D       LDA #$0D       JSR $E3D8       LDA #$07       STA $D2       LDA #$02       STA $D1       LDA #$08       STA $D4       LDA #$0F       STA $D3       LDA #$49      ;'I'       STA XX3003       LDA #$30      ;'0'       STA XX3004       LDA #$30      ;'0'       STA $DB       LDA #$03       STA $DA       JSR $F524       LDA #$07       JSR $F2AE       LDA #$31      ;'1'       STA XX3004       JSR $F524       LDA #$07       JSR $F2AE       LDA #$07       STA $D3       LDA #$30      ;'0'       STA $DB       LDA #$0D       STA $DA       LDA XX301D       STA $D1       JSR $F524XX30F1 JSR $F301       BNE XX30F9       JMP XX3180;********************************;;********************************XX30F9 JSR XX3271       CMP #$3B      ;';'       BNE XX30F1       LDA #$00       STA XX3003       STA XX3004       STA XX300A       JSR XX324F       BNE XX3122       JSR XX324F       CMP XX3009       BNE XX3183       JSR XX324F       CMP XX3008       BNE XX3183       BEQ XX3188XX3122 STA XX3007       INC XX3008       BNE XX312D       INC XX3009XX312D JSR XX328C       JSR XX324F       PHA        CLC        ADC XX3006       STA $43       PLA        JSR XX328C       JSR XX324F       PHA        CLC        ADC XX3005       STA $42       BCC XX314C       INC $43XX314C PLA        JSR XX328CXX3150 JSR XX324F       LDY XX300A       INC XX300A       STA ($42),Y       CMP ($42),Y       BNE XX317A       JSR XX328C       DEC XX3007       BNE XX3150       JSR XX324F       CMP XX3004       BNE XX317D       JSR XX324F       CMP XX3003       BNE XX317D       JMP XX30F1;********************************; NON-RAM LOAD;********************************XX317A LDX #AA71D2-XX31AE ;#$24      ;'$';********************************;;********************************       .BYTE $2C ;BIT ZP SKIP;********************************; CHECKSUM ERROR;********************************XX317D LDX #AA71DF-XX31AE ;#$31      ;'1';********************************;;********************************       .BYTE $2C ;BIT ZP SKIP;********************************; BREAKXX3180 LDX #AA71BF-XX31AE ;#$11;********************************       .BYTE $2C ;BIT ZP SKIP;********************************; BAD RECORD COUNT;********************************XX3183 LDX #$00       JSR XX3198XX3188 LDA #$07       JSR $F2AE       JSR CLRCHN;********************************; END OF LOAD;********************************       LDX #AA71C6-XX31AE ;#$18       JSR XX3198       JMP $C389;********************************;;********************************XX3198 STX XX300AXX319B LDX XX300A       LDA XX31AE,X       PHP        AND #$7F       JSR $E3D8       INC XX300A       PLP        BPL XX319B       RTS ;********************************;;********************************XX31AE .BYTE $0D       .TEXT 'BAD RECORD COUN'       .BYTE $D4;AA71BF .BYTE $0D       .TEXT 'BREAK'       .BYTE $8D;AA71C6 .BYTE $0D       .TEXT 'END OF LOA'       .BYTE $C4;AA71D2 .BYTE $0D       .TEXT 'NON-RAM LOA'       .BYTE $C4;AA71DF .BYTE $0D       .TEXT 'CHECKSUM ERRO'       .BYTE $D2;AA71EE .BYTE $0D       .BYTE $0D       .BYTE $0D       .TEXT '16K LOADER V121379'       .BYTE $0D       .TEXT '(C) 1979 BY COMMODORE BUSINESS MACHINES'       .BYTE $0D       .BYTE $0D       .BYTE $0D       .TEXT 'INPUT OFFSET?'       .BYTE $A0;AA723C .BYTE $0D       .TEXT 'OBJECT FILE NAME?'       .BYTE $A0;********************************;;********************************XX324F JSR XX3271       JSR XX3266       ASL A       ASL A       ASL A       ASL A       STA XX300B       JSR XX3271       JSR XX3266       ORA XX300B       RTS ;********************************;;********************************XX3266 CMP #$3A      ;':'       PHP        AND #$0F       PLP        BCC XX3270       ADC #$08XX3270 RTS ;********************************;;********************************XX3271 LDA XX300C       CMP #$07       BEQ XX3283       JSR CLRCHN       LDX #$07       STX XX300C       JSR $F770XX3283 JSR $F1E1       PHA        JSR $E3D8       PLA        RTS ;********************************;;********************************XX328C CLC        ADC XX3003       STA XX3003       BCC XX3298       INC XX3004XX3298 RTS ;********************************;;********************************AA3299 .BYTE $AA       .BYTE $AA       .BYTE $AA       .BYTE $AA       .BYTE $AA       .BYTE $AA       .BYTE $AA;********************************;;********************************.END